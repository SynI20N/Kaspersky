services:
 zipper_api:
  build: ../src/ZipperAPI
  image: zipper
  environment:
    - ASPNETCORE_ENVIRONMENT=Production
    - ARCHIVER_PATH=/usr/bin/7z
  volumes:
    - ../src/ZipperAPI/Data/Files:/app/Data/Files
    - ../src/ZipperAPI/Data/Archives:/app/Data/Archives
  ports:
    - "8080:8080"
    - "8081:8081"
 zipper_api_tests:
  build: 
    dockerfile: ../src/ZipperAPI.Tests/Dockerfile
    context: ../src
  image: zipper_tests
  environment:
    - ASPNETCORE_ENVIRONMENT=Production
    - ARCHIVER_PATH=/usr/bin/7z
    - TEST_PROJECT_FOLDER=/app
  volumes:
    - ../test-results:/app/test-results
    - ../src/ZipperAPI.Tests/Data/Files:/app/Data/Files
    - ../src/ZipperAPI.Tests/Data/Archives:/app/Data/Archives
 zipper_api_database:
  build: ../src/ZipperAPI.Database
  image: zipper_db
  secrets:
    - mongo_root_password
  ports: 
    - "8100:8100"

secrets:
  mongo_root_password:
    external: true
     